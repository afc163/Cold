Cold.add("app.datepicker",["dom","event"],function(){var f=Cold.dom,d=Cold.event,b=f.$CN("date"),a=new Date(),c;Cold.each(b,function(j){f.val(j,"readonly","true");var g=f.create("span");g.innerHTML="";f.css(g,{"float":"left","font-size":"12px",color:"#999",position:"absolute",left:"238px",top:"9px"});j.parentNode.style.position="relative";f.appendEnd(j.parentNode,g);var h=function(k){k.stopPropagation();if(!c){e()}c.show(j);document.onclick=function(){c.hide();document.onclick=null};c.DIV.onclick=function(l){l=d.fix(l);l.stopPropagation()}};d.click(j,h);d.click(g,h)});function e(){c={setDateTo:function(){c.input.value=c.year+"-"+(c.month+1)+"-"+c.day},setDateFrom:function(g){if(g){var h=g.match(/(\d{4})-(\d{1,2})-(\d{1,2})/);c.year=c.currentYear=parseInt(h[1],10);c.month=c.currentMonth=parseInt(h[2],10)-1;c.day=c.currentDay=parseInt(h[3],10)}else{c.year=c.currentYear=a.getFullYear();c.month=c.currentMonth=a.getMonth();c.day=c.currentDay=a.getDate()}},createDiv:function(j){var o=f.getXY(j),g=f.width(j),n=f.height(j),k=f.id("datepicker");if(!k){k=f.create("div");k.id="datepicker";f.css(k,{width:"168px",overflow:"hidden","font-size":"12px",color:"#555",background:"#fff","z-index":500,border:"1px solid #999",position:"absolute",left:o.x+"px",top:o.y+n-1+"px"});k.innerHTML='<div class="dpr_box">							<div class="dpr_select">								<select id="dpr_monthSelect"></select>								<select id="dpr_yearSelect"></select>							</div>							<div id="dpr_weeks"></div>							<ul id="dpr_days"></ul>						</div>';f.appendBody(k)}else{f.id("dpr_monthSelect").options.length=0;f.id("dpr_yearSelect").options.length=0;f.css(k,{left:o.x+"px",top:o.y+n-1+"px"});f.css(k,"display","block")}c.DIV=k;Cold.each(c.months,function(p,h){f.id("dpr_monthSelect").options[f.id("dpr_monthSelect").options.length]=new Option(p,h)});d.add(f.id("dpr_monthSelect"),"change",function(){c.month=f.id("dpr_monthSelect").value;c.update()});for(var l=c.yearStart;l>c.yearStart-c.yearRange-1;l--){f.id("dpr_yearSelect").options[f.id("dpr_yearSelect").options.length]=new Option(l,l)}d.add(f.id("dpr_yearSelect"),"change",function(){c.year=f.id("dpr_yearSelect").value;c.update()});var m="";Cold.each(c.weeks,function(h){m+="<li>"+h+"</li>"});f.id("dpr_weeks").innerHTML=m;c.update()},update:function(){var h=new Date();if(c.month&&c.year){h.setFullYear(c.year,c.month,1)}else{c.month=h.getMonth();c.year=h.getFullYear();h.setDate(1)}if((c.year%4==0&&c.year%100!=0)||c.year%400==0){c.daysInMonth[1]=29}else{c.daysInMonth[1]=28}var g=(1-(7+h.getDay()-c.startDay)%7);var j="";while(g<=c.daysInMonth[c.month]){for(i=0;i<7;i++){var k="";if((g==c.currentDay)&&(c.month==c.currentMonth)&&(c.year==c.currentYear)){k+=" dpr_selected"}if((g==a.getDate())&&(c.month==a.getMonth())&&(c.year==a.getFullYear())){k+=" dpr_today"}if((g<=c.daysInMonth[c.month])&&(g>0)){if(c.weekdays.indexOf(i)!==-1){j+='<li class="dpr_daySelect'+k+'" dateValue="'+c.year+"-"+(parseInt(c.month,10)+1)+"-"+g+'">'+g+"</li>"}else{j+='<li class="dpr_empty" style="color:#eee">'+g+"</li>"}}else{j+='<li class="dpr_empty"> </li>'}g++}}f.id("dpr_days").innerHTML=j;f.id("dpr_monthSelect").value=c.month;f.id("dpr_yearSelect").value=c.year;Cold.each(f.$CN("dpr_daySelect"),function(l){d.click(l,function(){c.setDateFrom(l.getAttribute("dateValue"));c.setDateTo(c.input);c.hide()});d.hover(l,{over:function(){f.addClass(l,"over")},out:function(){f.removeClass(l,"over")}})})},show:function(j){c.input=j;var h=c.input.getAttribute("yearStart");var g=c.input.getAttribute("range");c.weekdays=c.input.getAttribute("weekdays")||"1234567";c.yearStart=h?parseInt(h,10):(new Date().getFullYear());c.yearRange=g?parseInt(g,10):80;c.setDateFrom(c.input.value);c.createDiv(c.input);c.update()},hide:function(){c.DIV&&f.css(c.DIV,"display","none")}};c.weeks="日一二三四五六".split("");c.months="一月 二月 三月 四月 五月 六月 七月 八月 九月 十月 十一月 十二月".split(" ");c.daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31];c.startDay=7}});